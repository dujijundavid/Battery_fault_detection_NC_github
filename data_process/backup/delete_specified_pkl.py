#!/usr/bin/env python
# -*- coding: utf-8 -*-
import os
# ======== 1. 配置区域：自己改这里 ========
# 需要处理的文件夹路径（放 pkl 文件的那个文件夹）
FOLDER_PATH = r"C:\Users\YIFSHEN\Documents\01_InputRawData\top_500_mileage_pkl" # TODO：改成你的路径
# 需要删除的车辆编号列表，比如 ["0_0921", "0_2381", ...]
TARGET_CARS = [
    '0_0921', '0_0926', '0_0928', '0_0929', '0_0935', '0_0938', '0_0941', '0_0942', '0_0951', '0_0956', '0_0961', '0_0962', '0_0968', '0_0969', '0_0976', '0_0978', '0_0991', '0_0996', '0_0999', '0_2004', '0_2005', '0_2008', '0_2011', '0_2012', '0_2018', '0_2023', '0_2024', '0_2025', '0_2029', '0_2031', '0_2032', '0_2034', '0_2036', '0_2043', '0_2048', '0_2062', '0_2069', '0_2072', '0_2084', '0_2089', '0_2090', '0_2100', '0_2102', '0_2114', '0_2118', '0_2119', '0_2120', '0_2125', '0_2128', '0_2137', '0_2139', '0_2140', '0_2147', '0_2150', '0_2151', '0_2154', '0_2155', '0_2157', '0_2163', '0_2164', '0_2166', '0_2168', '0_2169', '0_2173', '0_2174', '0_2176', '0_2177', '0_2178', '0_2181', '0_2184', '0_2185', '0_2186', '0_2188', '0_2201', '0_2202', '0_2203', '0_2204', '0_2205', '0_2206', '0_2211', '0_2215', '0_2224', '0_2228', '0_2230', '0_2237', '0_2240', '0_2244', '0_2250', '0_2252', '0_2259', '0_2260', '0_2270', '0_2273', '0_2274', '0_2278', '0_2282', '0_2286', '0_2300', '0_2305', '0_2307', '0_2309', '0_2312', '0_2315', '0_2319', '0_2324', '0_2327', '0_2330', '0_2333', '0_2340', '0_2344', '0_2345', '0_2355', '0_2373', '0_2381', '0_2388', '0_2389', '0_2390', '0_2391', '0_2392', '0_2394', '0_2397', '0_2398', '0_2399', '0_2412', '0_2414', '0_2417', '0_2418', '0_2419', '0_2421', '0_2422', '0_2424', '0_2427', '0_2429', '0_2432', '0_2433', '0_2434', '0_2435', '0_2436', '0_2438', '0_2441', '0_2443', '0_2447', '0_2448', '0_2449', '0_2450', '0_2451', '0_2452', '0_2454', '0_2458', '0_2460', '0_2464', '0_2469', '0_2473', '0_2474', '0_2475', '0_2480', '0_2488', '0_2493', '0_2499', '0_2504', '0_2507', '0_2510', '0_2512', '0_2514', '0_2516', '0_2520', '0_2527', '0_2541', '0_2548', '0_2554', '0_2560', '0_2567', '0_2568', '0_2573', '0_2576', '0_2580', '0_2582', '0_2583', '0_2587', '0_2588', '0_2594', '0_2596', '0_2598', '0_2599', '0_2604', '0_2608', '0_2612', '0_2613', '0_2614', '0_2615', '0_2617', '0_2620', '0_2622', '0_2624', '0_2628', '0_2635', '0_2636', '0_2637', '0_2640', '0_2641', '0_2645', '0_2646', '0_2648', '0_2650', '0_2654', '0_2656', '0_2658', '0_2661', '0_2663', '0_2664', '0_2667', '0_2669', '0_2672', '0_2674', '0_2675', '0_2677', '0_2682', '0_2684', '0_2688', '0_2689', '0_2690', '0_2693', '0_2694', '0_2702', '0_2711', '0_2713', '0_2715', '0_2716', '0_2718', '0_2721', '0_2727', '0_2731', '0_2732', '0_2740', '0_2743', '0_2745', '0_2746', '0_2747', '0_2748', '0_2757', '0_2758', '0_2759', '0_2766', '0_2767', '0_2768', '0_2770', '0_2771', '0_2795', '0_2796', '0_2797', '0_2799', '0_2800', '0_2811', '0_2813', '0_2815', '0_2824', '0_2828', '0_2829', '0_2833', '0_2850', '0_2852', '0_2853', '0_2857'
]
# 是否先做“演习模式”（只打印将要删除的文件，不真正删除）
DRY_RUN = False # True = 只看不删；False = 真删
# ======== 2. 主逻辑：按车辆编号删除 pkl ========
def get_car_id_from_filename(filename: str) -> str | None:
    """
    根据文件名提取车辆编号。
    例如：0_0921_1_0.pkl -> 0_0921
    """
    if not filename.lower().endswith(".pkl"):
        return None
    name_only = os.path.splitext(filename)[0] # 去掉后缀 .pkl
    parts = name_only.split("_")
    if len(parts) < 2:
        return None
    # 车辆编号定义为：前两个字段，中间一个下划线
    car_id = f"{parts[0]}_{parts[1]}"
    return car_id
def delete_pkls_by_car_ids(folder: str, car_ids: list[str], dry_run: bool = True):
    if not os.path.isdir(folder):
        print(f"[ERROR] 目录不存在：{folder}")
        return
    car_ids = set(car_ids) # 用集合加速判断
    total_files = 0
    delete_files = 0
    print(f"目标目录：{folder}")
    print(f"待删除车辆编号：{sorted(car_ids)}")
    print(f"当前模式：{'DRY_RUN（仅打印不删除）' if dry_run else '真实删除'}")
    print("-" * 60)
    for fname in os.listdir(folder):
        fpath = os.path.join(folder, fname)
        # 只处理文件，不管子文件夹
        if not os.path.isfile(fpath):
            continue
        total_files += 1
        if not fname.lower().endswith(".pkl"):
            continue
        car_id = get_car_id_from_filename(fname)
        if car_id is None:
            continue
        if car_id in car_ids:
            delete_files += 1
            if dry_run:
                print(f"[DRY_RUN] 将删除：{fpath}")
            else:
                try:
                    os.remove(fpath)
                    print(f"[DELETED] 已删除：{fpath}")
                except Exception as e:
                    print(f"[ERROR] 删除失败：{fpath} -> {e}")
    print("-" * 60)
    print(f"目录中总文件数：{total_files}")
    print(f"匹配到并处理的 pkl 数量：{delete_files}")
    if dry_run:
        print("当前为 DRY_RUN 模式，没有真正删除文件。"
              "确认无误后，可将 DRY_RUN 设为 False 再运行。")
if __name__ == "__main__":
    delete_pkls_by_car_ids(FOLDER_PATH, TARGET_CARS, dry_run=DRY_RUN)