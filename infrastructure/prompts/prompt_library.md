# AI 图表生成 Prompt 库

> **目标**：提供场景化的 Prompt 模板，帮助你在不同工作流环节快速生成高质量图表，提升效率和一致性。

---

## 📖 使用指南

### Prompt 库结构

本文档按**工作流阶段**组织，每个阶段包含：
- **适用场景**：何时使用该 Prompt
- **Prompt 模板**：可直接复制使用的提示词
- **示例输出**：预期效果展示
- **变体提示**：针对不同需求的调整建议

### 使用建议

1. **复制即用**：直接复制模板，填入你的具体需求
2. **逐步迭代**：先生成基础版本，再通过追问优化细节
3. **保存调整**：记录对你项目有效的 Prompt 变体
4. **组合使用**：复杂场景下可串联多个 Prompt

---

## 🎯 一、需求分析阶段

### 1.1 从产品需求生成架构草图

**💡 适用场景**：
- 刚拿到 PRD（产品需求文档）
- 需要快速理解系统全貌
- 向团队展示高层设计思路

**📝 Prompt 模板**：

```
你是一位资深的 ML 系统架构师。请根据以下产品需求生成初步的系统架构图（使用 Mermaid graph 语法）：

【产品需求】
- 产品名称：<填写名称>
- 核心功能：<列出 3-5 个核心功能>
- 用户输入：<描述输入数据类型>
- 系统输出：<描述输出结果>
- 特殊约束：<如实时性要求、隐私要求等>

【输出要求】
1. 使用 Mermaid graph TB（从上到下）或 LR（从左到右）语法
2. 划分为至少 3 个层次（如：数据层、计算层、服务层）
3. 用 subgraph 标注每个层次
4. 用清晰的箭头表示数据流向
5. 标注关键技术栈（如 PostgreSQL、Redis、PyTorch）
```

**📊 示例输出场景**：

```
输入：电池故障预测系统
输出：包含"数据采集 → 特征工程 → 模型推理 → 告警系统"的多层架构图
```

**🔧 变体提示**：

| 需求调整         | Prompt 修改建议                                      |
| ---------------- | ---------------------------------------------------- |
| 需要微服务架构   | 添加"请使用微服务架构，每个服务用独立 subgraph 表示" |
| 需要云端部署方案 | 添加"标注 AWS/GCP/Azure 服务组件（如 S3、Lambda）"   |
| 需要对比多方案   | 添加"生成 2 个架构方案并对比优缺点"                  |

---

### 1.2 从需求生成数据流图

**💡 适用场景**：
- 明确数据从哪来、到哪去
- 识别数据处理瓶颈
- 规划数据存储策略

**📝 Prompt 模板**：

```
请根据以下需求生成数据流程图（Mermaid flowchart），重点展示数据的流转路径：

【数据需求】
- 数据源：<如传感器日志、数据库、API>
- 数据处理步骤：<清洗、转换、聚合等>
- 中间存储：<是否需要缓存、数据湖>
- 最终输出：<训练数据集、推理结果等>

【输出要求】
1. 使用 flowchart TD 语法
2. 明确标注每个数据处理节点
3. 用菱形表示数据质量检查决策点
4. 用圆柱体（[( )]）表示数据存储
5. 标注数据格式（如 CSV、Parquet、JSON）
```

**🔧 变体提示**：
- 添加"包含数据血缘追踪（标注版本号）"
- 添加"标注数据量级（如每日 1TB）"

---

## 🏗️ 二、架构设计阶段

### 2.1 从模块描述生成类图

**💡 适用场景**：
- 设计模型结构（如 DyAD、VAE）
- 规划代码组织架构
- 向工程师交接接口定义

**📝 Prompt 模板**：

```
你是 Python/ML 系统设计专家。请根据以下模块描述生成 UML 类图（Mermaid classDiagram）：

【模块描述】
- 模块名称：<如 DynamicVAE>
- 核心类：<列出 3-5 个关键类>
- 每个类的职责：<简述功能>
- 类之间的关系：<组合、继承、依赖>

【输出要求】
1. 使用 Mermaid classDiagram 语法
2. 标注每个类的关键属性（用 + 表示 public，- 表示 private）
3. 标注每个类的核心方法
4. 用箭头明确表示关系：
   - 继承：<|--
   - 组合：*--
   - 依赖：..>
5. 添加注释说明设计模式（如工厂模式、策略模式）
```

**📊 示例输出场景**：

```
输入：DyAD 模型包含 Encoder、Decoder、Trainer
输出：展示三者关系、输入输出维度、核心方法的类图
```

---

### 2.2 从深度学习论文生成模型架构图

**💡 适用场景**：
- 实现论文中的模型
- 理解复杂模型结构（如 Transformer）
- 制作技术文档

**📝 Prompt 模板**：

```
根据以下深度学习模型描述，生成详细的模型架构图（Mermaid graph）：

【模型信息】
- 模型名称：<如 Variational Autoencoder>
- 输入维度：<如 batch_size x seq_len x features>
- 关键层：<如 Encoder RNN、Latent Layer、Decoder RNN>
- 特殊机制：<如 Attention、重参数化>
- 输出维度：<重构结果、预测类别等>

【输出要求】
1. 使用 Mermaid graph LR 或 TB 语法
2. 用 subgraph 区分 Encoder、Latent Space、Decoder
3. 在每个节点标注维度变化（如 [B, 128, 64] → [B, 128, 32]）
4. 用虚线表示反向传播路径
5. 标注损失函数组件（如重构误差、KL 散度）
```

**🔧 变体提示**：
- 添加"包含前向传播的数值示例（假设 batch_size=2）"
- 添加"对比标准 VAE 和本模型的差异（用不同颜色区分）"

---

### 2.3 分布式训练架构设计

**💡 适用场景**：
- 设计多 GPU / 多节点训练方案
- 优化训练性能
- 向 SRE 团队说明资源需求

**📝 Prompt 模板**：

```
设计一个<数据并行/模型并行>的分布式训练架构，生成 Mermaid 架构图：

【训练需求】
- 模型规模：<参数量、层数>
- 硬件资源：<GPU 数量、节点数量>
- 并行策略：<数据并行 / 模型并行 / 混合并行>
- 梯度同步：<AllReduce / Parameter Server>

【输出要求】
1. 使用 Mermaid graph TB 语法
2. 用 subgraph 区分主节点和工作节点
3. 明确标注数据分片策略
4. 用虚线表示梯度同步路径
5. 标注通信开销关键点
```

---

## 🔄 三、开发实现阶段

### 3.1 从代码生成调用序列图

**💡 适用场景**：
- 理解现有代码逻辑
- Code Review 时展示交互流程
- 生成技术文档

**📝 Prompt 模板**：

```
分析以下代码，生成 Mermaid 序列图，展示函数/类之间的调用关系：

【代码片段】
```python
<粘贴你的代码，约 50-100 行>
```

【分析要求】
1. 识别主要参与者（类、模块、函数）
2. 按时间顺序列出方法调用
3. 标注关键参数传递（如数据维度、配置参数）
4. 区分同步调用（实线箭头）和异步调用（虚线箭头）
5. 标注循环结构（用 loop）

【输出格式】
使用 Mermaid sequenceDiagram 语法
```

**🔧 变体提示**：
- 添加"只关注核心路径，忽略日志和异常处理"
- 添加"标注每个步骤的时间复杂度"

---

### 3.2 从函数签名生成类图

**💡 适用场景**：
- 重构代码前梳理结构
- 设计模块接口
- 生成 API 文档

**📝 Prompt 模板**：

```
根据以下函数签名和类定义，生成 Mermaid 类图：

【代码结构】
```python
<粘贴类定义和主要方法签名>
```

【输出要求】
1. 使用 Mermaid classDiagram 语法
2. 推断类之间的关系（继承、组合、依赖）
3. 标注方法的输入输出类型
4. 识别设计模式并添加注释
```

---

## 🧪 四、实验管理阶段

### 4.1 超参数调优流程序列图

**💡 适用场景**：
- 设计自动化调优流程
- 向 PM 解释实验周期
- 集成 Optuna / Ray Tune

**📝 Prompt 模板**：

```
设计一个超参数调优流程，生成 Mermaid 序列图：

【调优需求】
- 搜索空间：<列出要调优的超参数>
- 优化目标：<如验证集 F1-Score>
- 搜索策略：<随机搜索 / 贝叶斯优化 / 遗传算法>
- 早停策略：<是否提前终止差实验>

【输出要求】
1. 参与者包括：研究员、实验管理器、搜索引擎、训练器、日志系统
2. 用 loop 表示多次试验
3. 标注每次试验的输入（超参数配置）和输出（指标）
4. 展示搜索策略更新逻辑
```

---

### 4.2 A/B 测试完整流程图

**💡 适用场景**：
- 设计模型灰度发布策略
- 规划线上实验流程
- 向产品团队汇报上线计划

**📝 Prompt 模板**：

```
设计一个 ML 模型 A/B 测试流程，生成 Mermaid flowchart：

【测试需求】
- 新模型特性：<说明改进点>
- 流量策略：<5% → 50% → 100%>
- 监控指标：<在线 CTR、延迟、错误率>
- 回滚条件：<指标下降 >5%>

【输出要求】
1. 使用 flowchart TD 语法
2. 包含决策节点（离线指标达标？在线指标优于基线？）
3. 明确标注灰度比例
4. 展示回滚路径
5. 标注每个阶段的监控时长
```

---

## 🚀 五、部署运维阶段

### 5.1 推理服务架构图

**💡 适用场景**：
- 设计线上推理 API
- 优化服务性能（缓存、限流）
- 向 SRE 团队交接部署方案

**📝 Prompt 模板**：

```
设计一个生产级别的 ML 推理服务架构，生成 Mermaid 架构图：

【服务需求】
- QPS 要求：<每秒请求量>
- 延迟要求：<如 P99 < 100ms>
- 可用性要求：<如 99.9%>
- 特殊需求：<如 GPU 推理、批处理>

【输出要求】
1. 包含层次：负载均衡器、API 网关、模型服务、缓存、数据库
2. 用 subgraph 区分前端、后端、存储层
3. 标注每层的技术选型（如 Nginx、FastAPI、Redis、PostgreSQL）
4. 用虚线表示可选的异步日志流
5. 标注扩展点（如水平扩展、模型版本切换）
```

---

### 5.2 模型服务状态机图

**💡 适用场景**：
- 设计服务启动流程
- 处理故障恢复逻辑
- 实现健康检查

**📝 Prompt 模板**：

```
设计一个模型服务的生命周期状态机，生成 Mermaid stateDiagram：

【服务行为】
- 启动步骤：<初始化 → 加载模型 → 预热 → 就绪>
- 正常状态：<接收请求 → 推理 → 返回结果>
- 异常情况：<性能下降、崩溃、自动重启>
- 更新流程：<热更新或冷重启>

【输出要求】
1. 使用 Mermaid stateDiagram-v2 语法
2. 标注每个状态转换的触发条件
3. 明确终止状态
4. 包含异常处理路径
```

---

### 5.3 监控与告警流程图

**💡 适用场景**：
- 设计模型漂移检测机制
- 规划自动再训练流程
- 搭建监控仪表板

**📝 Prompt 模板**：

```
设计一个 ML 模型监控与自动再训练流程，生成 Mermaid flowchart：

【监控需求】
- 监控指标：<模型性能、数据分布、系统资源>
- 告警阈值：<如准确率下降 >5%>
- 自动操作：<告警通知、自动回滚、触发再训练>

【输出要求】
1. 起点：在线推理服务
2. 监控节点：收集指标、与基线对比
3. 决策节点：是否触发告警？是否自动再训练？
4. 操作节点：发送通知、启动训练流水线、模型替换
5. 闭环：新模型部署后继续监控
```

---

## 🗂️ 六、文档整理阶段

### 6.1 项目 Gantt 图生成

**💡 适用场景**：
- 项目启动阶段排期
- 向管理层汇报进度
- 识别关键路径

**📝 Prompt 模板**：

```
根据以下 ML 项目任务，生成 Gantt 图（Mermaid gantt）：

【项目信息】
- 项目名称：<项目名>
- 开始日期：<YYYY-MM-DD>
- 主要阶段：<需求分析、数据准备、模型开发、部署、监控>
- 每个阶段的任务：<列出具体任务>
- 任务依赖：<哪些任务需要等待前置任务完成>

【输出要求】
1. 使用 Mermaid gantt 语法
2. 用 section 区分项目阶段
3. 标注里程碑（milestone）
4. 标注关键任务（crit）
5. 合理分配任务时长（建议单位：天或周）
6. 排除周末（excludes weekends）
```

**🔧 变体提示**：
- 添加"标注每个任务的负责人"
- 添加"预留 20% 的缓冲时间"

---

### 6.2 多图组合技术文档

**💡 适用场景**：
- 编写设计文档
- 准备技术评审材料
- 知识库沉淀

**📝 Prompt 模板**：

```
为以下 ML 系统生成一份完整的技术设计文档，包含多种图表：

【系统概述】
- 系统名称：<名称>
- 核心目标：<解决什么问题>
- 技术栈：<主要技术>

【文档结构要求】
1. **概述** + 系统架构图（Mermaid graph）
2. **数据流** + 数据处理流程图（Mermaid flowchart）
3. **模型设计** + 模型架构图（Mermaid graph）
4. **训练流程** + 序列图（Mermaid sequenceDiagram）
5. **部署方案** + 部署架构图（Mermaid graph）
6. **项目计划** + Gantt 图（Mermaid gantt）

【输出格式】
Markdown 格式，每个图表前加简短说明（2-3 句话）
```

---

## 🔍 七、代码理解与逆向工程

### 7.1 从代码生成流程图

**💡 适用场景**：
- 理解复杂的数据处理逻辑
- 重构前梳理现有流程
- 发现冗余步骤

**📝 Prompt 模板**：

```
分析以下 Python 代码，提取核心逻辑并生成流程图（Mermaid flowchart）：

【代码片段】
```python
<粘贴代码>
```

【分析要求】
1. 识别主要步骤（函数调用、数据转换）
2. 提取条件分支（if/else）
3. 识别循环结构（for/while）
4. 忽略日志、异常处理等辅助逻辑
5. 标注关键变量的值变化

【输出格式】
使用 Mermaid flowchart TD 语法，节点名简洁易懂
```

---

### 7.2 从项目结构生成依赖图

**💡 适用场景**：
- 新人快速了解项目
- 识别循环依赖
- 规划模块拆分

**📝 Prompt 模板**：

```
根据以下项目目录结构，生成模块依赖关系图（Mermaid graph）：

【项目结构】
```
<粘贴 tree 命令输出或手动列出主要目录/文件>
```

【分析要求】
1. 识别主要模块（如 data_loader、model、trainer、utils）
2. 根据 import 语句推断依赖关系
3. 用 subgraph 区分层次（如数据层、模型层、应用层）
4. 用箭头表示依赖方向（A → B 表示 A 依赖 B）

【输出格式】
Mermaid graph LR 或 TB 语法
```

---

## 🎨 八、进阶：自定义与优化

### 8.1 图表美化与主题定制

**💡 适用场景**：
- 准备对外分享的技术博客
- 制作高质量 PPT
- 统一团队图表风格

**📝 Prompt 模板**：

```
为以下 Mermaid 图表添加自定义主题，使其更美观专业：

【当前图表】
```mermaid
<粘贴你的 Mermaid 代码>
```

【美化要求】
1. 使用 %%{init: {'theme':'base', 'themeVariables': {...}}}%% 语法
2. 自定义颜色方案（建议提供品牌色或偏好颜色）
3. 调整节点形状（方形、圆角、圆形）
4. 优化文字大小和字体
5. 确保配色适合打印（避免过浅颜色）

【参考风格】
<可选：提供参考图片或描述，如"科技蓝风格"、"柔和中性色">
```

---

### 8.2 复杂图表拆分建议

**💡 适用场景**：
- 图表节点过多（>20 个）难以阅读
- 需要分层展示细节

**📝 Prompt 模板**：

```
以下 Mermaid 图表过于复杂，请帮我拆分为多个层次的图表：

【原图表】
```mermaid
<粘贴复杂图表代码>
```

【拆分策略】
1. 生成一个高层概览图（3-5 个主要模块）
2. 为每个模块生成详细子图
3. 用统一的命名规范关联主图与子图
4. 在主图中用注释标注"详见子图 X"

【输出格式】
Markdown 文档，包含主图 + N 个子图，每个图前有简短说明
```

---

## 📚 九、场景速查表

快速定位你的需求对应的 Prompt：

| 你的场景                       | 推荐 Prompt                  | 章节 |
| ------------------------------ | ---------------------------- | ---- |
| 刚拿到需求文档，不知道怎么设计 | 从产品需求生成架构草图       | 1.1  |
| 需要梳理数据从哪来到哪去       | 从需求生成数据流图           | 1.2  |
| 要实现一个论文模型，不清楚结构 | 从深度学习论文生成模型架构图 | 2.2  |
| 代码太复杂，想可视化调用关系   | 从代码生成调用序列图         | 3.1  |
| 设计超参数调优流程             | 超参数调优流程序列图         | 4.1  |
| 模型要上线，需要设计推理服务   | 推理服务架构图               | 5.1  |
| 项目排期不清晰                 | 项目 Gantt 图生成            | 6.1  |
| 接手老代码，看不懂逻辑         | 从代码生成流程图             | 7.1  |
| 图表太复杂，别人看不懂         | 复杂图表拆分建议             | 8.2  |

---

## 🚀 十、Prompt 使用最佳实践

### 1. 渐进式细化策略

**不推荐**：一次性提供所有细节，Prompt 过长导致模型遗漏关键点

**推荐**：
1. **第一轮**：用基础 Prompt 生成初稿
2. **第二轮**：追问"请添加 XX 细节"
3. **第三轮**：优化格式"请用子图区分不同层次"

**示例对话**：
```
User: 生成一个电池故障预测系统的架构图
AI: <生成基础版本>
User: 请添加数据采集层的传感器类型（温度、电压、电流）
AI: <更新版本>
User: 请用不同颜色区分在线推理和离线训练流程
AI: <最终版本>
```

---

### 2. 提供具体示例

**模糊**："生成一个训练流程图"

**清晰**：
```
生成一个包含以下步骤的训练流程图：
1. 加载数据（从 S3 读取 PKL 文件）
2. 数据预处理（归一化、序列切分）
3. 模型训练（五折交叉验证）
4. 模型评估（计算 F1、AUC）
5. 模型保存（保存到 ModelRegistry）
```

---

### 3. 指定输出格式

在 Prompt 中明确要求：
- **图表类型**：Mermaid graph / flowchart / sequenceDiagram
- **方向**：TB（从上到下）/ LR（从左到右）
- **特殊元素**：subgraph、loop、milestone
- **标注要求**：维度、数据格式、技术栈

---

### 4. 迭代优化模板库

建议为你的项目创建专属 Prompt 库：

```markdown
# 我的项目 Prompt 库

## 电池故障检测架构图
<保存你调优后的 Prompt>

## DyAD 模型结构图
<保存你调优后的 Prompt>

## 五折训练流程序列图
<保存你调优后的 Prompt>
```

每次生成图表后，记录：
- ✅ 有效的 Prompt 变体
- ❌ 无效的尝试（避免重复踩坑）

---

### 5. 组合 Prompt 链

复杂需求可以拆分为多步：

**场景**：为新项目生成完整技术文档

**Prompt 链**：
1. 用"从产品需求生成架构草图"生成高层架构
2. 用"从需求生成数据流图"细化数据部分
3. 用"从深度学习论文生成模型架构图"完善模型设计
4. 用"项目 Gantt 图生成"添加时间规划
5. 用"多图组合技术文档"整合所有图表

---

## 🎯 十一、常见问题与解决方案

### Q1: 生成的图表节点太多，难以阅读

**解决方案**：
- 使用"复杂图表拆分建议" Prompt（8.2）
- 在原 Prompt 中添加"只展示核心路径，忽略边缘 case"
- 要求"用省略号（...）表示重复模式"

---

### Q2: 图表方向不对（想要横向但生成了纵向）

**解决方案**：
明确在 Prompt 中指定：
- `graph LR`（从左到右）
- `graph TB`（从上到下）
- `flowchart LR`（流程图横向）

---

### Q3: Mermaid 图表渲染失败

**常见原因**：
- 特殊字符（如 `~`、`<`、`>`）未转义
- 节点名包含空格但未加引号
- 箭头语法错误（如 `->>` 用于 sequenceDiagram，`-->` 用于 graph）

**解决方案**：
在 Prompt 中添加"确保语法符合 Mermaid 规范，节点名用引号包裹"

---

### Q4: 想复用某个图表结构，只改内容

**解决方案**：
使用"模板复用" Prompt：
```
请参照以下图表结构，但替换为新的内容：

【参考图表】
<粘贴现有图表代码>

【新内容】
- 节点 A → 新节点 X
- 节点 B → 新节点 Y
...
```

---

## 📋 十二、Prompt 演化清单

随着项目推进，定期更新你的 Prompt 库：

- [ ] **Week 1**：使用基础 Prompt 生成初版图表
- [ ] **Week 2**：根据团队反馈调整 Prompt（如增加细节、调整风格）
- [ ] **Week 4**：为常用场景创建快捷 Prompt（保存为代码片段）
- [ ] **Month 2**：建立团队 Prompt 规范（统一格式、命名）
- [ ] **Month 3**：整理 Prompt 最佳实践文档（分享给新成员）

---

## 🌟 总结

本 Prompt 库覆盖了 ML 系统从**需求分析 → 架构设计 → 开发实现 → 实验管理 → 部署运维 → 文档整理**的完整生命周期。

**使用建议**：
1. **新手**：从场景速查表（第 9 章）找到匹配的 Prompt，直接复制使用
2. **进阶**：根据最佳实践（第 10 章）定制专属 Prompt
3. **专家**：构建团队 Prompt 库，沉淀最佳实践

**下一步**：
- 选择一个当前项目场景，尝试相应 Prompt
- 记录有效的 Prompt 变体到个人知识库
- 定期回顾和优化 Prompt 模板

祝你用 AI 辅助绘图提升 10 倍效率！🚀
